<element name="bs4-alert"><template id="bs4-alert"><style>
:host {
    display: block;
    padding: .75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: .25rem;
    background-color: #aaa
}
:host(.alert-success) {
    background-color: #dff0d8;
    border-color: #d0e9c6;
    color: #3c763d
}
:host(.alert-info) {
    background-color: #d9edf7;
    border-color: #bcdff1;
    color: #31708f
}
:host(.alert-warning) {
    background-color: #fcf8e3;
    border-color: #faf2cc;
    color: #8a6d3b
}
:host(.alert-danger) {
    background-color: #f2dede;
    border-color: #ebcccc;
    color: #a94442
}
:host(.fade) {
    opacity: 0;
    transition: opacity .15s linear
}
:host(.fade.show) {
    opacity: 1
}
::slotted(button.close) {
    padding: 0;
    cursor: pointer;
    background: 0 0;
    border: 0;
    -webkit-appearance: none;
    float: right;
    font-size: 1.5rem !important;
    font-weight: 700;
    line-height: 1;
    color: #000;
    text-shadow: 0 1px 0 #fff;
    opacity: .5
}</style><slot></slot></template><script>

(function () {
	class AlertElement extends HTMLElement {

  		static get observedAttributes() {return ['type', 'button']; }
  
		// Define getters/setters for properties. 
		get type() {
			return this.getAttribute('type');
		}
		set type(val) {
			if (val) {
				this.setAttribute('type', '');
			} else {
				this.removeAttribute('open');
			}
		}

		get button() {
			return this.getAttribute('button');
		}
		set button(val) {
			if (val === 'true') {
				this.setAttribute('button', 'true');
				this.appendCloseButton();
			} else {
				this.setAttribute('button', 'false');
				this.removeCloseButton();
			}
		}

		constructor() {
			// always call super() first in the ctor.
			super();

			let shadowRoot = this.attachShadow({ mode: 'closed' });
			let template = doc.querySelector("#bs4-alert");

			shadowRoot.innerHTML = template.innerHTML;
		}

		connectedCallback() {
			this.setAttribute('role', 'alert');
			this.classList.add("fade");
			this.classList.add("show");

			if (this.type && ['info', 'success', 'warning', 'danger'].indexOf(this.type) > -1) {
				this.classList.add('alert-' + this.type);
			} else {
				// No value, defaults to info
				this.classList.add('alert-info');
			}
			
			if (this.button && this.button === "true") {
				this.appendCloseButton();
			}
		}

		disconnectedCallback() {
			this.removeEventListener('close.bs.alert', this);
			this.removeEventListener('closed.bs.alert', this);
			this.firstChild.removeEventListener('click', this.firstChild);
		}

		attributeChangedCallback(attrName, oldVal, newVal) {
			console.log(attrName)
	        if (attrName === 'type') {
	        	console.log(attrName, oldVal, newVal);
	            if (this.classList.contains('alert-' + oldVal) && ['info', 'warning', 'danger', 'success'].indexOf(newVal) > -1) {
	                this.classList.remove('alert-' + oldVal);
	                this.classList.add('alert-' + newVal);
	            }
	        }
	        if (attrName === 'button') {
	            if (oldVal === "true" && newVal === "false")
	                this.removeCloseButton();
	            if (oldVal === "false" && newVal === "true")
	                this.appendCloseButton();
	        }
		}

		close() {
			this.dispatchCustomEvent('close.bs.alert');
			if ('WebkitTransition' in document.documentElement.style || 
			'transition' in document.documentElement.style) {
				this.addEventListener("transitionend", function (event) {
					event.target.dispatchCustomEvent('closed.bs.alert');
					event.target.parentNode.removeChild(event.target);
				}, false);
			}
			this.classList.remove('show');
			if (!'WebkitTransition' in document.documentElement.style ||
				!'transition' in document.documentElement.style) {
				this.dispatchCustomEvent('closed.bs.alert');
				this.parentNode.removeChild(this);
			}
		}

		dispatchCustomEvent(eventName) {
			var OriginalCustomEvent = new CustomEvent(eventName);
			OriginalCustomEvent.relatedTarget = this;
			this.dispatchEvent(OriginalCustomEvent);
			this.removeEventListener(eventName, this);
		}

		appendCloseButton() {
			if (!this.querySelector('button[aria-label="Close"]')) {
				var closeButton = document.createElement('button');
				closeButton.setAttribute('type', 'button');
				closeButton.setAttribute('aria-label', 'Close');
				closeButton.classList.add('close');
				closeButton.innerHTML = '<span aria-hidden="true">&times;</span>';

				if (this.firstChild)
					this.insertBefore(closeButton, this.firstChild); else this.appendChild(closeButton);
				// Add the required listener 
				closeButton.addEventListener('click', function (event) {
					var element = event.target;
					if (event.target.parentNode.tagName.toLowerCase() === 'button') {
						element = event.target.parentNode;
					}

					element.parentNode.close();
				});
			}
		}
		removeCloseButton() {
			if (this.querySelector('button[aria-label="Close"]')) {
				this.firstChild.removeEventListener('click', this.firstChild)
				this.removeChild(this.firstChild);
			}
		}
	}

	window.addEventListener('WebComponentsReady', function () {
		// Register the element 
		customElements.define('bs4-alert', AlertElement);
	});
	// customElements.whenDefined('bs4-alert').then(() => {
	// 	console.log('ready!');
	// });
	const doc = (document._currentScript || document.currentScript).ownerDocument;
})();


</script></element>
